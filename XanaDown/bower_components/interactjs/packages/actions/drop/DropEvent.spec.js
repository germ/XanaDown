import test from '@interactjs/_dev/test/test';
import * as utils from '@interactjs/utils';
import DropEvent from '../drop/DropEvent';
const dz1 = { target: 'dz1', fire(event) { this.fired = event; } };
const dz2 = { target: 'dz2', fire(event) { this.fired = event; } };
const el1 = Symbol('el1');
const el2 = Symbol('el2');
const interactable = Symbol('interactable');
const dragElement = Symbol('drag-el');
test('DropEvent constructor', (t) => {
    const interaction = { dropState: {} };
    const dragEvent = Object.freeze({
        interactable,
        _interaction: interaction,
        target: dragElement,
        timeStamp: 10,
    });
    utils.extend(interaction.dropState, {
        activeDrops: [
            { dropzone: dz1, element: el1 },
            { dropzone: dz2, element: el2 },
        ],
        cur: { dropzone: dz1, element: el1 },
        prev: { dropzone: dz2, element: el2 },
        events: {},
    });
    const dropmove = new DropEvent(interaction.dropState, dragEvent, 'dropmove');
    t.equal(dropmove.target, el1, 'dropmove uses dropState.cur.element');
    t.equal(dropmove.dropzone, dz1, 'dropmove uses dropState.cur.dropzone');
    t.equal(dropmove.relatedTarget, dragElement);
    const dragleave = new DropEvent(interaction.dropState, dragEvent, 'dragleave');
    t.equal(dragleave.target, el2, 'dropmove uses dropState.prev.element');
    t.equal(dragleave.dropzone, dz2, 'dropmove uses dropState.prev.dropzone');
    t.equal(dragleave.relatedTarget, dragElement);
    t.end();
});
test('DropEvent.reject()', (t) => {
    const interaction = { dropState: {} };
    const dragEvent = Object.freeze({
        interactable,
        _interaction: interaction,
        target: dragElement,
        timeStamp: 10,
    });
    utils.extend(interaction.dropState, {
        activeDrops: [
            { dropzone: dz1, element: el1 },
            { dropzone: dz2, element: el2 },
        ],
        cur: { dropzone: null, element: null },
        prev: { dropzone: null, element: null },
        events: {},
    });
    const dropactivate = new DropEvent(interaction.dropState, dragEvent, 'dropactivate');
    dropactivate.dropzone = dz1;
    dropactivate.target = el1;
    dropactivate.reject();
    t.ok(dropactivate.propagationStopped && dropactivate.immediatePropagationStopped, 'rejected event propagation is stopped');
    t.equal(dz1.fired.type, 'dropdeactivate', 'dropdeactivate is fired on rejected dropzone');
    t.deepEqual(interaction.dropState.activeDrops, [{ dropzone: dz2, element: el2 }], 'activeDrop of rejected dropactivate event is removed');
    t.deepEqual(interaction.dropState.cur, { dropzone: null, element: null }, 'dropState.cur dropzone and element are set to null after rejecting dropactivate');
    utils.extend(interaction.dropState, {
        cur: { dropzone: dz1, element: el1 },
        prev: { dropzone: null, element: null },
        events: {},
    });
    const dropmove = new DropEvent(interaction.dropState, dragEvent, 'dropmove');
    dropmove.reject();
    t.deepEqual(interaction.dropState.cur, { dropzone: dz1, element: el1 }, 'dropState.cur remains the same after rejecting non activate event');
    t.ok(interaction.dropState.rejected, 'dropState.rejected === true');
    t.equal(dz1.fired.type, 'dragleave', 'dragleave is fired on rejected dropzone');
    t.end();
});
test('DropEvent.stop[Immediate]Propagation()', (t) => {
    const dropEvent = new DropEvent({ cur: {} }, {}, 'dragmove');
    t.notOk(dropEvent.propagationStopped || dropEvent.immediatePropagationStopped);
    dropEvent.stopPropagation();
    t.ok(dropEvent.propagationStopped);
    t.notOk(dropEvent.immediatePropagationStopped);
    dropEvent.propagationStopped = false;
    dropEvent.stopImmediatePropagation();
    t.ok(dropEvent.propagationStopped && dropEvent.immediatePropagationStopped);
    t.end();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRHJvcEV2ZW50LnNwZWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJEcm9wRXZlbnQuc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLElBQUksTUFBTSw0QkFBNEIsQ0FBQTtBQUU3QyxPQUFPLEtBQUssS0FBSyxNQUFNLG1CQUFtQixDQUFBO0FBQzFDLE9BQU8sU0FBUyxNQUFNLG1CQUFtQixDQUFBO0FBRXpDLE1BQU0sR0FBRyxHQUFRLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUUsS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFBLENBQUMsQ0FBQyxFQUFFLENBQUE7QUFDdkUsTUFBTSxHQUFHLEdBQVEsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBRSxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUEsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtBQUN2RSxNQUFNLEdBQUcsR0FBUSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUE7QUFDOUIsTUFBTSxHQUFHLEdBQVEsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQzlCLE1BQU0sWUFBWSxHQUFRLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQTtBQUNoRCxNQUFNLFdBQVcsR0FBUSxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUE7QUFFMUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7SUFDbEMsTUFBTSxXQUFXLEdBQVEsRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUFFLENBQUE7SUFDMUMsTUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUM5QixZQUFZO1FBQ1osWUFBWSxFQUFFLFdBQVc7UUFDekIsTUFBTSxFQUFFLFdBQVc7UUFDbkIsU0FBUyxFQUFFLEVBQUU7S0FDZCxDQUFrQixDQUFBO0lBRW5CLEtBQUssQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLFNBQVMs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QUUsQ0FBQTtBQUNULENBQUMsQ0FBQyxDQUFBO0FBRUYsSUFBSSxDQUFDLHdDQUF3QyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7SUFDbkQsTUFBTSxTQUFTLEdBQUcsSUFBSSxTQUFTLENBQUMsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFTLEVBQUUsRUFBUyxFQUFFLFVBQVUsQ0FBQyxDQUFBO0lBRTFFLENBQUMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLGtCQUFrQixJQUFJLFNBQVMsQ0FBQywyQkFBMkIsQ0FBQyxDQUFBO0lBRTlFLFNBQVMsQ0FBQyxlQUFlLEVBQUUsQ0FBQTtJQUMzQixDQUFDLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFBO0lBQ2xDLENBQUMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLDJCQUEyQixDQUFDLENBQUE7SUFFOUMsU0FBUyxDQUFDLGtCQUFrQixHQUFHLEtBQUssQ0FBQTtJQUVwQyxTQUFTLENBQUMsd0JBQXdCLEVBQUUsQ0FBQTtJQUNwQyxDQUFDLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsSUFBSSxTQUFTLENBQUMsMkJBQTJCLENBQUMsQ0FBQTtJQUUzRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUE7QUFDVCxDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0ZXN0IGZyb20gJ0BpbnRlcmFjdGpzL19kZXYvdGVzdC90ZXN0J1xuaW1wb3J0IEludGVyYWN0RXZlbnQgZnJvbSAnQGludGVyYWN0anMvY29yZS9JbnRlcmFjdEV2ZW50J1xuaW1wb3J0ICogYXMgdXRpbHMgZnJvbSAnQGludGVyYWN0anMvdXRpbHMnXG5pbXBvcnQgRHJvcEV2ZW50IGZyb20gJy4uL2Ryb3AvRHJvcEV2ZW50J1xuXG5jb25zdCBkejE6IGFueSA9IHsgdGFyZ2V0OiAnZHoxJywgZmlyZSAoZXZlbnQpIHsgdGhpcy5maXJlZCA9IGV2ZW50IH0gfVxuY29uc3QgZHoyOiBhbnkgPSB7IHRhcmdldDogJ2R6MicsIGZpcmUgKGV2ZW50KSB7IHRoaXMuZmlyZWQgPSBldmVudCB9IH1cbmNvbnN0IGVsMTogYW55ID0gU3ltYm9sKCdlbDEnKVxuY29uc3QgZWwyOiBhbnkgPSBTeW1ib2woJ2VsMicpXG5jb25zdCBpbnRlcmFjdGFibGU6IGFueSA9IFN5bWJvbCgnaW50ZXJhY3RhYmxlJylcbmNvbnN0IGRyYWdFbGVtZW50OiBhbnkgPSBTeW1ib2woJ2RyYWctZWwnKVxuXG50ZXN0KCdEcm9wRXZlbnQgY29uc3RydWN0b3InLCAodCkgPT4ge1xuICBjb25zdCBpbnRlcmFjdGlvbjogYW55ID0geyBkcm9wU3RhdGU6IHt9IH1cbiAgY29uc3QgZHJhZ0V2ZW50ID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgaW50ZXJhY3RhYmxlLFxuICAgIF9pbnRlcmFjdGlvbjogaW50ZXJhY3Rpb24sXG4gICAgdGFyZ2V0OiBkcmFnRWxlbWVudCxcbiAgICB0aW1lU3RhbXA6IDEwLFxuICB9KSBhcyBJbnRlcmFjdEV2ZW50XG5cbiAgdXRpbHMuZXh0ZW5kKGludGVyYWN0aW9uLmRyb3BTdGF0ZSwge1xuICAgIGFjdGl2ZURyb3BzOiBbXG4gICAgICB7IGRyb3B6b25lOiBkejEsIGVsZW1lbnQ6IGVsMSB9LFxuICAgICAgeyBkcm9wem9uZTogZHoyLCBlbGVtZW50OiBlbDIgfSxcbiAgICBdLFxuICAgIGN1ciA6IHsgZHJvcHpvbmU6IGR6MSwgZWxlbWVudDogZWwxIH0sXG4gICAgcHJldjogeyBkcm9wem9uZTogZHoyLCBlbGVtZW50OiBlbDIgfSxcbiAgICBldmVudHM6IHt9LFxuICB9KVxuXG4gIGNvbnN0IGRyb3Btb3ZlID0gbmV3IERyb3BFdmVudChpbnRlcmFjdGlvbi5kcm9wU3RhdGUsIGRyYWdFdmVudCwgJ2Ryb3Btb3ZlJylcblxuICB0LmVxdWFsKGRyb3Btb3ZlLnRhcmdldCwgZWwxLCAnZHJvcG1vdmUgdXNlcyBkcm9wU3RhdGUuY3VyLmVsZW1lbnQnKVxuICB0LmVxdWFsKGRyb3Btb3ZlLmRyb3B6b25lLCBkejEsICdkcm9wbW92ZSB1c2VzIGRyb3BTdGF0ZS5jdXIuZHJvcHpvbmUnKVxuICB0LmVxdWFsKGRyb3Btb3ZlLnJlbGF0ZWRUYXJnZXQsIGRyYWdFbGVtZW50KVxuXG4gIGNvbnN0IGRyYWdsZWF2ZSA9IG5ldyBEcm9wRXZlbnQoaW50ZXJhY3Rpb24uZHJvcFN0YXRlLCBkcmFnRXZlbnQsICdkcmFnbGVhdmUnKVxuXG4gIHQuZXF1YWwoZHJhZ2xlYXZlLnRhcmdldCwgZWwyLCAnZHJvcG1vdmUgdXNlcyBkcm9wU3RhdGUucHJldi5lbGVtZW50JylcbiAgdC5lcXVhbChkcmFnbGVhdmUuZHJvcHpvbmUsIGR6MiwgJ2Ryb3Btb3ZlIHVzZXMgZHJvcFN0YXRlLnByZXYuZHJvcHpvbmUnKVxuICB0LmVxdWFsKGRyYWdsZWF2ZS5yZWxhdGVkVGFyZ2V0LCBkcmFnRWxlbWVudClcblxuICB0LmVuZCgpXG59KVxuXG50ZXN0KCdEcm9wRXZlbnQucmVqZWN0KCknLCAodCkgPT4ge1xuICBjb25zdCBpbnRlcmFjdGlvbjogYW55ID0geyBkcm9wU3RhdGU6IHt9IH1cbiAgY29uc3QgZHJhZ0V2ZW50ID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgaW50ZXJhY3RhYmxlLFxuICAgIF9pbnRlcmFjdGlvbjogaW50ZXJhY3Rpb24sXG4gICAgdGFyZ2V0OiBkcmFnRWxlbWVudCxcbiAgICB0aW1lU3RhbXA6IDEwLFxuICB9KSBhcyBJbnRlcmFjdEV2ZW50XG5cbiAgdXRpbHMuZXh0ZW5kKGludGVyYWN0aW9uLmRyb3BTdGF0ZSwge1xuICAgIGFjdGl2ZURyb3BzOiBbXG4gICAgICB7IGRyb3B6b25lOiBkejEsIGVsZW1lbnQ6IGVsMSB9LFxuICAgICAgeyBkcm9wem9uZTogZHoyLCBlbGVtZW50OiBlbDIgfSxcbiAgICBdLFxuICAgIGN1ciA6IHsgZHJvcHpvbmU6IG51bGwsIGVsZW1lbnQ6IG51bGwgfSxcbiAgICBwcmV2OiB7IGRyb3B6b25lOiBudWxsLCBlbGVtZW50OiBudWxsIH0sXG4gICAgZXZlbnRzOiB7fSxcbiAgfSlcblxuICBjb25zdCBkcm9wYWN0aXZhdGUgPSBuZXcgRHJvcEV2ZW50KGludGVyYWN0aW9uLmRyb3BTdGF0ZSwgZHJhZ0V2ZW50LCAnZHJvcGFjdGl2YXRlJylcblxuICBkcm9wYWN0aXZhdGUuZHJvcHpvbmUgPSBkejFcbiAgZHJvcGFjdGl2YXRlLnRhcmdldCA9IGVsMVxuICBkcm9wYWN0aXZhdGUucmVqZWN0KClcblxuICB0Lm9rKGRyb3BhY3RpdmF0ZS5wcm9wYWdhdGlvblN0b3BwZWQgJiYgZHJvcGFjdGl2YXRlLmltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCxcbiAgICAncmVqZWN0ZWQgZXZlbnQgcHJvcGFnYXRpb24gaXMgc3RvcHBlZCcpXG5cbiAgdC5lcXVhbChkejEuZmlyZWQudHlwZSwgJ2Ryb3BkZWFjdGl2YXRlJywgJ2Ryb3BkZWFjdGl2YXRlIGlzIGZpcmVkIG9uIHJlamVjdGVkIGRyb3B6b25lJylcblxuICB0LmRlZXBFcXVhbChcbiAgICBpbnRlcmFjdGlvbi5kcm9wU3RhdGUuYWN0aXZlRHJvcHMsXG4gICAgW3sgZHJvcHpvbmU6IGR6MiwgZWxlbWVudDogZWwyIH1dLFxuICAgICdhY3RpdmVEcm9wIG9mIHJlamVjdGVkIGRyb3BhY3RpdmF0ZSBldmVudCBpcyByZW1vdmVkJylcblxuICB0LmRlZXBFcXVhbChcbiAgICBpbnRlcmFjdGlvbi5kcm9wU3RhdGUuY3VyLFxuICAgIHsgZHJvcHpvbmU6IG51bGwsIGVsZW1lbnQ6IG51bGwgfSxcbiAgICAnZHJvcFN0YXRlLmN1ciBkcm9wem9uZSBhbmQgZWxlbWVudCBhcmUgc2V0IHRvIG51bGwgYWZ0ZXIgcmVqZWN0aW5nIGRyb3BhY3RpdmF0ZScpXG5cbiAgdXRpbHMuZXh0ZW5kKGludGVyYWN0aW9uLmRyb3BTdGF0ZSwge1xuICAgIGN1ciA6IHsgZHJvcHpvbmU6IGR6MSwgZWxlbWVudDogZWwxIH0sXG4gICAgcHJldjogeyBkcm9wem9uZTogbnVsbCwgZWxlbWVudDogbnVsbCB9LFxuICAgIGV2ZW50czoge30sXG4gIH0pXG5cbiAgY29uc3QgZHJvcG1vdmUgPSBuZXcgRHJvcEV2ZW50KGludGVyYWN0aW9uLmRyb3BTdGF0ZSwgZHJhZ0V2ZW50LCAnZHJvcG1vdmUnKVxuXG4gIGRyb3Btb3ZlLnJlamVjdCgpXG5cbiAgdC5kZWVwRXF1YWwoXG4gICAgaW50ZXJhY3Rpb24uZHJvcFN0YXRlLmN1cixcbiAgICB7IGRyb3B6b25lOiBkejEsIGVsZW1lbnQ6IGVsMSB9LFxuICAgICdkcm9wU3RhdGUuY3VyIHJlbWFpbnMgdGhlIHNhbWUgYWZ0ZXIgcmVqZWN0aW5nIG5vbiBhY3RpdmF0ZSBldmVudCcpXG5cbiAgdC5vayhpbnRlcmFjdGlvbi5kcm9wU3RhdGUucmVqZWN0ZWQsICdkcm9wU3RhdGUucmVqZWN0ZWQgPT09IHRydWUnKVxuXG4gIHQuZXF1YWwoZHoxLmZpcmVkLnR5cGUsICdkcmFnbGVhdmUnLCAnZHJhZ2xlYXZlIGlzIGZpcmVkIG9uIHJlamVjdGVkIGRyb3B6b25lJylcblxuICB0LmVuZCgpXG59KVxuXG50ZXN0KCdEcm9wRXZlbnQuc3RvcFtJbW1lZGlhdGVdUHJvcGFnYXRpb24oKScsICh0KSA9PiB7XG4gIGNvbnN0IGRyb3BFdmVudCA9IG5ldyBEcm9wRXZlbnQoeyBjdXI6IHt9IH0gYXMgYW55LCB7fSBhcyBhbnksICdkcmFnbW92ZScpXG5cbiAgdC5ub3RPayhkcm9wRXZlbnQucHJvcGFnYXRpb25TdG9wcGVkIHx8IGRyb3BFdmVudC5pbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQpXG5cbiAgZHJvcEV2ZW50LnN0b3BQcm9wYWdhdGlvbigpXG4gIHQub2soZHJvcEV2ZW50LnByb3BhZ2F0aW9uU3RvcHBlZClcbiAgdC5ub3RPayhkcm9wRXZlbnQuaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkKVxuXG4gIGRyb3BFdmVudC5wcm9wYWdhdGlvblN0b3BwZWQgPSBmYWxzZVxuXG4gIGRyb3BFdmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKVxuICB0Lm9rKGRyb3BFdmVudC5wcm9wYWdhdGlvblN0b3BwZWQgJiYgZHJvcEV2ZW50LmltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZClcblxuICB0LmVuZCgpXG59KVxuIl19