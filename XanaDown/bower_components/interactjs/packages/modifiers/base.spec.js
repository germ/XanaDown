import test from '@interactjs/_dev/test/test';
import * as helpers from '@interactjs/core/tests/_helpers';
import * as utils from '@interactjs/utils';
import modifiersBase from './base';
test('modifiers/base', (t) => {
    const { scope, target, interaction, interactable, } = helpers.testEnv({ plugins: [modifiersBase] });
    scope.actions.eventTypes.push('TESTstart', 'TESTmove', 'TESTend');
    t.ok(utils.is.object(interaction.modifiers), 'modifiers prop is added new Interaction');
    const element = target;
    const startEvent = {
        pageX: 100,
        pageY: 200,
        clientX: 100,
        clientY: 200,
        target: element,
    };
    const moveEvent = {
        pageX: 400,
        pageY: 500,
        clientX: 400,
        clientY: 500,
        target: element,
    };
    const options = { target: { x: 100, y: 100 }, setStart: true };
    let firedEvents = [];
    interactable.rectChecker(() => ({ top: 0, left: 0, bottom: 50, right: 50 }));
    interactable.on('TESTstart TESTmove TESTend', (event) => firedEvents.push(event));
    interaction.pointerDown(startEvent, startEvent, element);
    interactable.options.TEST = {
        enabled: true,
        modifiers: [
            {
                options,
                methods: targetModifier,
            },
        ],
    };
    interaction.start({ name: 'TEST' }, interactable, element);
    t.ok(options.started, 'modifier methods.start() was called');
    t.ok(options.setted, 'modifier methods.set() was called');
    t.deepEqual(interaction.prevEvent.page, options.target, 'start event coords are modified');
    t.deepEqual(interaction.coords.start.page, { x: 100, y: 200 }, 'interaction.coords.start are restored after action start phase');
    t.deepEqual(interaction.coords.cur.page, { x: 100, y: 200 }, 'interaction.coords.cur are restored after action start phase');
    interaction.pointerMove(moveEvent, moveEvent, element);
    t.deepEqual(interaction.coords.cur.page, { x: moveEvent.pageX, y: moveEvent.pageY }, 'interaction.coords.cur are restored after action move phase');
    t.deepEqual(interaction.coords.start.page, { x: startEvent.pageX, y: startEvent.pageY }, 'interaction.coords.start are restored after action move phase');
    t.deepEqual({ x: interaction.prevEvent.x0, y: interaction.prevEvent.y0 }, { x: 100, y: 100 }, 'move event start coords are modified');
    firedEvents = [];
    const similarMoveEvent = { ...moveEvent, pageX: moveEvent.pageX + 0.5 };
    interaction.pointerMove(similarMoveEvent, similarMoveEvent, element);
    t.equal(firedEvents.length, 0, 'duplicate result coords are ignored');
    interaction.stop();
    t.ok(options.stopped, 'modifier methods.stop() was called');
    // don't set start
    options.setStart = null;
    // add second modifier
    interactable.options.TEST.modifiers.push({
        options,
        methods: doubleModifier,
    });
    interaction.pointerDown(startEvent, startEvent, element);
    interaction.start({ name: 'TEST' }, interactable, element);
    t.notOk(options.setted, 'modifier methods.set() was not called on start phase without options.setStart');
    t.deepEqual(interaction.prevEvent.page, { x: 100, y: 200 }, 'start event coords are not modified without options.setStart');
    t.deepEqual(interaction.coords.start.page, { x: 100, y: 200 }, 'interaction.coords.start are not modified without options.setStart');
    interaction.pointerMove(moveEvent, moveEvent, element);
    t.deepEqual(interaction.prevEvent.page, { x: 200, y: 200 }, 'move event coords are modified by all modifiers');
    // modifier options.type
    scope.modifiers.target = modifiersBase.makeModifier(targetModifier);
    options.type = 'target';
    options.started = false;
    interactable.options.TEST = {
        enabled: true,
        modifiers: [
            options,
        ],
    };
    interaction.stop();
    interaction.start({ name: 'TEST' }, interactable, element);
    t.ok(options.started, 'gets `scpe.modifiers[options.type]`');
    interaction.pointerMove(moveEvent, moveEvent, element);
    t.doesNotThrow(() => {
        interaction._signals.fire('action-resume', {
            interaction,
        });
    });
    interaction.stop();
    t.end();
});
const targetModifier = {
    start({ state }) {
        state.options.started = true;
    },
    set({ state, coords }) {
        const { target } = state.options;
        coords.x = target.x;
        coords.y = target.y;
        state.options.setted = true;
    },
    stop({ state }) {
        state.options.stopped = true;
        delete state.options.started;
        delete state.options.setted;
    },
};
const doubleModifier = {
    start() { },
    set({ coords }) {
        coords.x *= 2;
        coords.y *= 2;
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5zcGVjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYmFzZS5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sSUFBSSxNQUFNLDRCQUE0QixDQUFBO0FBQzdDLE9BQU8sS0FBSyxPQUFPLE1BQU0saUNBQWlDLENBQUE7QUFDMUQsT0FBTyxLQUFLLEtBQUssTUFBTSxtQkFBbUIsQ0FBQTtBQUMxQyxPQUFPLGFBQWEsTUFBTSxRQUFRLENBQUE7QUFFbEMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7SUFDM0IsTUFBTSxFQUNKLEtBQUssRUFDTCxNQUFNLEVBQ04sV0FBVyxFQUNYLFlBQVksR0FDYixHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUE7SUFFakQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxVQUFVLEVBQUUsU0FBUyxDQUFDLENBQUE7SUFFakUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLEVBQUUseUNBQXlDLENBQUMsQ0FBQTtJQUV2RixNQUFNLE9BQU8sR0FBRyxNQUFpQixDQUFBO0lBQ2pDLE1BQU0sVUFBVSxHQUFHO1FBQ2pCLEtBQUssRUFBRSxHQUFHO1FBQ1YsS0FBSyxFQUFFLEdBQUc7UUFDVixPQUFPLEVBQUUsR0FBRztRQUNaLE9BQU8sRUFBRSxHQUFHO1FBQ1osTUFBTSxFQUFFLE9BQU87S0FDVCxDQUFBO0lBQ1IsTUFBTSxTQUFTLEdBQUc7UUFDaEIsS0FBSyxFQUFFLEdBQUc7UUFDVixLQUFLLEVBQUUsR0FBRztRQUNWLE9BQU8sRUFBRSxHQUFHO1FBQ1osT0FBTyxFQUFFLEdBQUc7UUFDWixNQUFNLEVBQUUsT0FBTztLQUNULENBQUE7SUFDUixNQUFNLE9B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QUFFO1FBQ2QsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFBO0lBQzlCLENBQUM7SUFDRCxHQUFHLENBQUUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFO1FBQ3BCLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFBO1FBRWhDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQTtRQUNuQixNQUFNLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUE7UUFFbkIsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFBO0lBQzdCLENBQUM7SUFDRCxJQUFJLENBQUUsRUFBRSxLQUFLLEVBQUU7UUFDYixLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUE7UUFDNUIsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQTtRQUM1QixPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFBO0lBQzdCLENBQUM7Q0FDRixDQUFBO0FBRUQsTUFBTSxjQUFjLEdBQUc7SUFDckIsS0FBSyxLQUFLLENBQUM7SUFDWCxHQUFHLENBQUUsRUFBRSxNQUFNLEVBQUU7UUFDYixNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUNiLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ2YsQ0FBQztDQUNGLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdGVzdCBmcm9tICdAaW50ZXJhY3Rqcy9fZGV2L3Rlc3QvdGVzdCdcbmltcG9ydCAqIGFzIGhlbHBlcnMgZnJvbSAnQGludGVyYWN0anMvY29yZS90ZXN0cy9faGVscGVycydcbmltcG9ydCAqIGFzIHV0aWxzIGZyb20gJ0BpbnRlcmFjdGpzL3V0aWxzJ1xuaW1wb3J0IG1vZGlmaWVyc0Jhc2UgZnJvbSAnLi9iYXNlJ1xuXG50ZXN0KCdtb2RpZmllcnMvYmFzZScsICh0KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBzY29wZSxcbiAgICB0YXJnZXQsXG4gICAgaW50ZXJhY3Rpb24sXG4gICAgaW50ZXJhY3RhYmxlLFxuICB9ID0gaGVscGVycy50ZXN0RW52KHsgcGx1Z2luczogW21vZGlmaWVyc0Jhc2VdIH0pXG5cbiAgc2NvcGUuYWN0aW9ucy5ldmVudFR5cGVzLnB1c2goJ1RFU1RzdGFydCcsICdURVNUbW92ZScsICdURVNUZW5kJylcblxuICB0Lm9rKHV0aWxzLmlzLm9iamVjdChpbnRlcmFjdGlvbi5tb2RpZmllcnMpLCAnbW9kaWZpZXJzIHByb3AgaXMgYWRkZWQgbmV3IEludGVyYWN0aW9uJylcblxuICBjb25zdCBlbGVtZW50ID0gdGFyZ2V0IGFzIEVsZW1lbnRcbiAgY29uc3Qgc3RhcnRFdmVudCA9IHtcbiAgICBwYWdlWDogMTAwLFxuICAgIHBhZ2VZOiAyMDAsXG4gICAgY2xpZW50WDogMTAwLFxuICAgIGNsaWVudFk6IDIwMCxcbiAgICB0YXJnZXQ6IGVsZW1lbnQsXG4gIH0gYXMgYW55XG4gIGNvbnN0IG1vdmVFdmVudCA9IHtcbiAgICBwYWdlWDogNDAwLFxuICAgIHBhZ2VZOiA1MDAsXG4gICAgY2xpZW50WDogNDAwLFxuICAgIGNsaWVudFk6IDUwMCxcbiAgICB0YXJnZXQ6IGVsZW1lbnQsXG4gIH0gYXMgYW55XG4gIGNvbnN0IG9wdGlvbnM6IGFueSA9IHsgdGFyZ2V0OiB7IHg6IDEwMCwgeTogMTAwIH0sIHNldFN0YXJ0OiB0cnVlIH1cbiAgbGV0IGZpcmVkRXZlbnRzID0gW11cblxuICBpbnRlcmFjdGFibGUucmVjdENoZWNrZXIoKCkgPT4gKHsgdG9wOiAwLCBsZWZ0OiAwLCBib3R0b206IDUwLCByaWdodDogNTAgfSkpXG4gIGludGVyYWN0YWJsZS5vbignVEVTVHN0YXJ0IFRFU1Rtb3ZlIFRFU1RlbmQnLCAoZXZlbnQpID0+IGZpcmVkRXZlbnRzLnB1c2goZXZlbnQpKVxuICBpbnRlcmFjdGlvbi5wb2ludGVyRG93bihzdGFydEV2ZW50LCBzdGFydEV2ZW50LCBlbGVtZW50KVxuXG4gIGludGVyYWN0YWJsZS5vcHRpb25zLlRFU1QgPSB7XG4gICAgZW5hYmxlZDogdHJ1ZSxcbiAgICBtb2RpZmllcnM6IFtcbiAgICAgIHtcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgbWV0aG9kczogdGFyZ2V0TW9kaWZpZXIsXG4gICAgICB9LFxuICAgIF0sXG4gIH1cblxuICBpbnRlcmFjdGlvbi5zdGFydCh7IG5hbWU6ICdURVNUJyB9LCBpbnRlcmFjdGFibGUsIGVsZW1lbnQpXG5cbiAgdC5vayhcbiAgICBvcHRpb25zLnN0YXJ0ZWQsXG4gICAgJ21vZGlmaWVyIG1ldGhvZHMuc3RhcnQoKSB3YXMgY2FsbGVkJyxcbiAgKVxuXG4gIHQub2soXG4gICAgb3B0aW9ucy5zZXR0ZWQsXG4gICAgJ21vZGlmaWVyIG1ldGhvZHMuc2V0KCkgd2FzIGNhbGxlZCcsXG4gIClcblxuICB0LmRlZXBFcXVhbChcbiAgICBpbnRlcmFjdGlvbi5wcmV2RXZlbnQucGFnZSxcbiAgICBvcHRpb25zLnRhcmdldCxcbiAgICAnc3RhcnQgZXZlbnQgY29vcmRzIGFyZSBtb2RpZmllZCcpXG5cbiAgdC5kZWVwRXF1YWwoXG4gICAgaW50ZXJhY3Rpb24uY29vcmRzLnN0YXJ0LnBhZ2UsXG4gICAgeyB4OiAxMDAsIHk6IDIwMCB9LFxuICAgICdpbnRlcmFjdGlvbi5jb29yZHMuc3RhcnQgYXJlIHJlc3RvcmVkIGFmdGVyIGFjdGlvbiBzdGFydCBwaGFzZScpXG5cbiAgdC5kZWVwRXF1YWwoXG4gICAgaW50ZXJhY3Rpb24uY29vcmRzLmN1ci5wYWdlLFxuICAgIHsgeDogMTAwLCB5OiAyMDAgfSxcbiAgICAnaW50ZXJhY3Rpb24uY29vcmRzLmN1ciBhcmUgcmVzdG9yZWQgYWZ0ZXIgYWN0aW9uIHN0YXJ0IHBoYXNlJylcblxuICBpbnRlcmFjdGlvbi5wb2ludGVyTW92ZShtb3ZlRXZlbnQsIG1vdmVFdmVudCwgZWxlbWVudClcblxuICB0LmRlZXBFcXVhbChcbiAgICBpbnRlcmFjdGlvbi5jb29yZHMuY3VyLnBhZ2UsXG4gICAgeyB4OiBtb3ZlRXZlbnQucGFnZVgsIHk6IG1vdmVFdmVudC5wYWdlWSB9LFxuICAgICdpbnRlcmFjdGlvbi5jb29yZHMuY3VyIGFyZSByZXN0b3JlZCBhZnRlciBhY3Rpb24gbW92ZSBwaGFzZScpXG5cbiAgdC5kZWVwRXF1YWwoXG4gICAgaW50ZXJhY3Rpb24uY29vcmRzLnN0YXJ0LnBhZ2UsXG4gICAgeyB4OiBzdGFydEV2ZW50LnBhZ2VYLCB5OiBzdGFydEV2ZW50LnBhZ2VZIH0sXG4gICAgJ2ludGVyYWN0aW9uLmNvb3Jkcy5zdGFydCBhcmUgcmVzdG9yZWQgYWZ0ZXIgYWN0aW9uIG1vdmUgcGhhc2UnKVxuXG4gIHQuZGVlcEVxdWFsKFxuICAgIHsgeDogaW50ZXJhY3Rpb24ucHJldkV2ZW50LngwLCB5OiBpbnRlcmFjdGlvbi5wcmV2RXZlbnQueTAgfSxcbiAgICB7IHg6IDEwMCwgeTogMTAwIH0sXG4gICAgJ21vdmUgZXZlbnQgc3RhcnQgY29vcmRzIGFyZSBtb2RpZmllZCcpXG5cbiAgZmlyZWRFdmVudHMgPSBbXVxuICBjb25zdCBzaW1pbGFyTW92ZUV2ZW50ID0geyAuLi5tb3ZlRXZlbnQsIHBhZ2VYOiBtb3ZlRXZlbnQucGFnZVggKyAwLjUgfVxuICBpbnRlcmFjdGlvbi5wb2ludGVyTW92ZShzaW1pbGFyTW92ZUV2ZW50LCBzaW1pbGFyTW92ZUV2ZW50LCBlbGVtZW50KVxuICB0LmVxdWFsKGZpcmVkRXZlbnRzLmxlbmd0aCwgMCwgJ2R1cGxpY2F0ZSByZXN1bHQgY29vcmRzIGFyZSBpZ25vcmVkJylcblxuICBpbnRlcmFjdGlvbi5zdG9wKClcblxuICB0Lm9rKFxuICAgIG9wdGlvbnMuc3RvcHBlZCxcbiAgICAnbW9kaWZpZXIgbWV0aG9kcy5zdG9wKCkgd2FzIGNhbGxlZCcsXG4gIClcblxuICAvLyBkb24ndCBzZXQgc3RhcnRcbiAgb3B0aW9ucy5zZXRTdGFydCA9IG51bGxcbiAgLy8gYWRkIHNlY29uZCBtb2RpZmllclxuICBpbnRlcmFjdGFibGUub3B0aW9ucy5URVNULm1vZGlmaWVycy5wdXNoKHtcbiAgICBvcHRpb25zLFxuICAgIG1ldGhvZHM6IGRvdWJsZU1vZGlmaWVyLFxuICB9KVxuXG4gIGludGVyYWN0aW9uLnBvaW50ZXJEb3duKHN0YXJ0RXZlbnQsIHN0YXJ0RXZlbnQsIGVsZW1lbnQpXG4gIGludGVyYWN0aW9uLnN0YXJ0KHsgbmFtZTogJ1RFU1QnIH0sIGludGVyYWN0YWJsZSwgZWxlbWVudClcblxuICB0Lm5vdE9rKFxuICAgIG9wdGlvbnMuc2V0dGVkLFxuICAgICdtb2RpZmllciBtZXRob2RzLnNldCgpIHdhcyBub3QgY2FsbGVkIG9uIHN0YXJ0IHBoYXNlIHdpdGhvdXQgb3B0aW9ucy5zZXRTdGFydCcsXG4gIClcblxuICB0LmRlZXBFcXVhbChcbiAgICBpbnRlcmFjdGlvbi5wcmV2RXZlbnQucGFnZSxcbiAgICB7IHg6IDEwMCwgeTogMjAwIH0sXG4gICAgJ3N0YXJ0IGV2ZW50IGNvb3JkcyBhcmUgbm90IG1vZGlmaWVkIHdpdGhvdXQgb3B0aW9ucy5zZXRTdGFydCcpXG5cbiAgdC5kZWVwRXF1YWwoXG4gICAgaW50ZXJhY3Rpb24uY29vcmRzLnN0YXJ0LnBhZ2UsXG4gICAgeyB4OiAxMDAsIHk6IDIwMCB9LFxuICAgICdpbnRlcmFjdGlvbi5jb29yZHMuc3RhcnQgYXJlIG5vdCBtb2RpZmllZCB3aXRob3V0IG9wdGlvbnMuc2V0U3RhcnQnKVxuXG4gIGludGVyYWN0aW9uLnBvaW50ZXJNb3ZlKG1vdmVFdmVudCwgbW92ZUV2ZW50LCBlbGVtZW50KVxuXG4gIHQuZGVlcEVxdWFsKFxuICAgIGludGVyYWN0aW9uLnByZXZFdmVudC5wYWdlLFxuICAgIHsgeDogMjAwLCB5OiAyMDAgfSxcbiAgICAnbW92ZSBldmVudCBjb29yZHMgYXJlIG1vZGlmaWVkIGJ5IGFsbCBtb2RpZmllcnMnKVxuXG4gIC8vIG1vZGlmaWVyIG9wdGlvbnMudHlwZVxuICBzY29wZS5tb2RpZmllcnMudGFyZ2V0ID0gbW9kaWZpZXJzQmFzZS5tYWtlTW9kaWZpZXIodGFyZ2V0TW9kaWZpZXIpXG4gIG9wdGlvbnMudHlwZSA9ICd0YXJnZXQnXG4gIG9wdGlvbnMuc3RhcnRlZCA9IGZhbHNlXG4gIGludGVyYWN0YWJsZS5vcHRpb25zLlRFU1QgPSB7XG4gICAgZW5hYmxlZDogdHJ1ZSxcbiAgICBtb2RpZmllcnM6IFtcbiAgICAgIG9wdGlvbnMsXG4gICAgXSxcbiAgfVxuICBpbnRlcmFjdGlvbi5zdG9wKClcbiAgaW50ZXJhY3Rpb24uc3RhcnQoeyBuYW1lOiAnVEVTVCcgfSwgaW50ZXJhY3RhYmxlLCBlbGVtZW50KVxuXG4gIHQub2sob3B0aW9ucy5zdGFydGVkLCAnZ2V0cyBgc2NwZS5tb2RpZmllcnNbb3B0aW9ucy50eXBlXWAnKVxuXG4gIGludGVyYWN0aW9uLnBvaW50ZXJNb3ZlKG1vdmVFdmVudCwgbW92ZUV2ZW50LCBlbGVtZW50KVxuXG4gIHQuZG9lc05vdFRocm93KCgpID0+IHtcbiAgICBpbnRlcmFjdGlvbi5fc2lnbmFscy5maXJlKCdhY3Rpb24tcmVzdW1lJywge1xuICAgICAgaW50ZXJhY3Rpb24sXG4gICAgfSlcbiAgfSlcblxuICBpbnRlcmFjdGlvbi5zdG9wKClcblxuICB0LmVuZCgpXG59KVxuXG5jb25zdCB0YXJnZXRNb2RpZmllciA9IHtcbiAgc3RhcnQgKHsgc3RhdGUgfSkge1xuICAgIHN0YXRlLm9wdGlvbnMuc3RhcnRlZCA9IHRydWVcbiAgfSxcbiAgc2V0ICh7IHN0YXRlLCBjb29yZHMgfSkge1xuICAgIGNvbnN0IHsgdGFyZ2V0IH0gPSBzdGF0ZS5vcHRpb25zXG5cbiAgICBjb29yZHMueCA9IHRhcmdldC54XG4gICAgY29vcmRzLnkgPSB0YXJnZXQueVxuXG4gICAgc3RhdGUub3B0aW9ucy5zZXR0ZWQgPSB0cnVlXG4gIH0sXG4gIHN0b3AgKHsgc3RhdGUgfSkge1xuICAgIHN0YXRlLm9wdGlvbnMuc3RvcHBlZCA9IHRydWVcbiAgICBkZWxldGUgc3RhdGUub3B0aW9ucy5zdGFydGVkXG4gICAgZGVsZXRlIHN0YXRlLm9wdGlvbnMuc2V0dGVkXG4gIH0sXG59XG5cbmNvbnN0IGRvdWJsZU1vZGlmaWVyID0ge1xuICBzdGFydCAoKSB7fSxcbiAgc2V0ICh7IGNvb3JkcyB9KSB7XG4gICAgY29vcmRzLnggKj0gMlxuICAgIGNvb3Jkcy55ICo9IDJcbiAgfSxcbn1cbiJdfQ==